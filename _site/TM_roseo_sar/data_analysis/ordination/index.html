<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Microbes + Biogeochemistry">
    <meta name="author" content="Shane Hogle">
    
    <link rel="canonical" href="///TM_roseo_sar/data_analysis/ordination/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="//css/pixyll.css" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Blog">
    <meta property="og:description" content="Microbes + Biogeochemistry">
    <meta property="og:url" content="//TM_roseo_sar/data_analysis/ordination/">
    <meta property="og:site_name" content="Blog">
</head>

<body class="">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="/" class="site-title">Blog</a>
      <nav class="site-nav right">
        <a href="//about/">Shane Hogle</a>
<a href="//publications/">Publications</a>
<a href="//research/">Research</a>
<a href="//contact/">Contact</a>

      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        <div class="post">
  <header class="post-header">
    <h1 class="h2"></h1>
  </header>
  <article class="post-content">
  <h2 id="reference-publication">Reference publication</h2>

<p><strong>Hogle SL</strong>, Thrash JC, Dupont CL, Barbeau KA. (2016). Trace metal acquisition by heterotrophic bacterioplankton with contrasting trophic strategies. Appl. Environ. Microbiol. 82(5): XX-XX <a href="http://aem.asm.org/content/early/2016/01/04/AEM.03128-15">LINK</a>
___</p>

<h2 id="introduction-ordination-and-multivariate-statistics">Introduction: Ordination and multivariate statistics</h2>

<p>Here we perform principle components analysis (PCA) and non-metric multidimmensional scaling (NMDS) in order to explore patterns of metal uptake genes in Roseobacter and SAR11. We also look at multivariate homogeneity of group dispersions for each taxonomic class in both NMDS and PCA ordinations in order to determine which group is more variable in terms of their transport capabilities.</p>

<h3 id="load-required-libraries">Load required libraries</h3>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"vegan"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"grid"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"MASS"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="import-the-dataset">Import the dataset</h3>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">metalCountData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"sar11_roseo_metaluptake_counts.tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">genomeFeat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"sar11_roseo_genome_feat.tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">genomeCategories</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"sar11_roseo_categories.tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="create-reduced-dataframes">Create reduced dataframes</h3>

<p>Dataframes without rows containing NA values in the Lifestyle category. Necessary for envfit analysis of factors</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">metalCountData.reduc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">metalCountData</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">genomeCategories</span><span class="o">$</span><span class="n">Lifestyle</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">genomeCategories.reduc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">genomeCategories</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">genomeCategories</span><span class="o">$</span><span class="n">Lifestyle</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<h3 id="vegan-implementation-of-pca">Vegan implementation of PCA</h3>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">metal.rda</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rda</span><span class="p">(</span><span class="n">metalCountData</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>PCA on reduced dataset</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">metal.rda.reduc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rda</span><span class="p">(</span><span class="n">metalCountData.reduc</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="fit-environmental-factors-onto-the-reduced-ordination">Fit environmental factors onto the reduced ordination</h3>

<p>Using Lifestyle factor for environmnetal fitting</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">753</span><span class="p">)</span><span class="w">
</span><span class="n">ef.reduc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">envfit</span><span class="p">(</span><span class="n">metal.rda.reduc</span><span class="p">,</span><span class="w"> </span><span class="n">genomeCategories.reduc</span><span class="p">,</span><span class="w"> </span><span class="n">permu</span><span class="o">=</span><span class="m">999</span><span class="p">)</span><span class="w">
</span><span class="n">ef.reduc</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>***FACTORS:

Centroids:
                           PC1     PC2
LifestyleFreeliving    -0.5893  0.1681
LifestyleSurface_assoc  0.6161 -0.1757
TaxaRoseobacter         0.6262 -0.1673
TaxaSAR11              -0.6547  0.1749

Goodness of fit:
              r2 Pr(&gt;r)    
Lifestyle 0.3284  0.001 ***
Taxa      0.3674  0.001 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
Permutation: free
Number of permutations: 999
</code></pre>
</div>

<p>Here we see that both the classifications of taxa (Roseobacter vs SAR11) and the classification of Lifestyle (surface associated/patch adapted vs freeliving) are significantly associated with the ordination. So the differences in metal transporter repretoir appear to be related to the differences between taxa and Lifestyle.</p>

<h3 id="multivariate-homogeneity-of-group-dispersions">Multivariate homogeneity of group dispersions</h3>

<p>Here we calculate dispersion values for euclidean distance based on SAR11 vs Roseobacter groups in order to determine which group has a larger dsipersion or spread</p>

<p>Need to do dispersion calculation on a distance matrix. Use euclidean because PCA uses euclidean distances</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">metal_tran_dis</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vegdist</span><span class="p">(</span><span class="n">metalCountData</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"euclidean"</span><span class="p">)</span><span class="w">
</span><span class="n">disper</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">betadisper</span><span class="p">(</span><span class="n">metal_tran_dis</span><span class="p">,</span><span class="w"> </span><span class="n">genomeCategories</span><span class="o">$</span><span class="n">Taxa</span><span class="p">,</span><span class="w"> </span><span class="n">bias.adjust</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">disper</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>	Homogeneity of multivariate dispersions

Call: betadisper(d = metal_tran_dis, group = genomeCategories$Taxa,
bias.adjust = TRUE)

No. of Positive Eigenvalues: 40
No. of Negative Eigenvalues: 0

Average distance to median:
Roseobacter       SAR11 
      4.278       1.112 

Eigenvalues for PCoA axes:
   PCoA1    PCoA2    PCoA3    PCoA4    PCoA5    PCoA6    PCoA7    PCoA8 
737.4761 186.1731  91.6971  52.1355  35.0828  27.6643  24.7258  22.2809 
</code></pre>
</div>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">permutest</span><span class="p">(</span><span class="n">disper</span><span class="p">,</span><span class="w"> </span><span class="n">pairwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
          Df Sum Sq Mean Sq      F N.Perm Pr(&gt;F)    
Groups     1 144.69 144.694 60.194    999  0.001 ***
Residuals 62 149.04   2.404                         
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above diagonal)
            Roseobacter SAR11
Roseobacter             0.001
SAR11        1.0391e-10      
</code></pre>
</div>

<p>We can see here that Roseobacter has a greater average distance to median (4.278) compared to SAR11 (1.112) and that this difference is significant based on permuted model residuals generating a permutations distribution of F under the null hypothesis that there is no difference in dispersion between groups. This indicates that Roseobacter trace metal transporter inventory is more diverse and variable than in SAR11.</p>

<h3 id="plotting-the-pca-analysis">Plotting the PCA analysis</h3>

<p>Uses scores function to put site PC values into scrcs. Then associate a variable with them - in this case using the Lifestyle category. The result is a dataframe</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">scrs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">scores</span><span class="p">(</span><span class="n">metal.rda</span><span class="p">,</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sites"</span><span class="p">))</span><span class="w">
</span><span class="n">scrs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">scrs</span><span class="p">,</span><span class="w"> </span><span class="n">lifestyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">genomeCategories</span><span class="o">$</span><span class="n">Lifestyle</span><span class="p">,</span><span class="w"> </span><span class="n">taxa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">genomeCategories</span><span class="o">$</span><span class="n">Taxa</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Fit factors and continuous variables to ordinations</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">152</span><span class="p">)</span><span class="w">
</span><span class="n">ef</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">envfit</span><span class="p">(</span><span class="n">metal.rda</span><span class="p">,</span><span class="w"> </span><span class="n">genomeFeat</span><span class="p">,</span><span class="w"> </span><span class="n">permu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">999</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Use the score function again to load direction of vectors. Vectors here are weighted by R<sup>2</sup> value</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">spp.scrs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">scores</span><span class="p">(</span><span class="n">ef</span><span class="p">,</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"vectors"</span><span class="p">))</span><span class="w">
</span><span class="n">spp.scrs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">spp.scrs</span><span class="p">,</span><span class="w"> </span><span class="n">Species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">spp.scrs</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>make the ggplot object</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">scrs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC2</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taxa</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifestyle</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">## need aspect ratio of 1!
</span><span class="w">  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spp.scrs</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC1</span><span class="p">,</span><span class="w"> 
                                    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC2</span><span class="p">),</span><span class="w"> 
                                   </span><span class="n">arrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">)),</span><span class="w"> 
                                   </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spp.scrs</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC2</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/TM_roseo_sar/data_analysis/output_33_0.svg" alt="svg" /></p>

<h3 id="vegan-implementation-of-nmds">Vegan implementation of NMDS</h3>

<p>We’ll now perform the same analysis as above using NMDS. NMDS is a popular and very robust ordination method, and it is frequently used in microbial ecology studies. We want to make sure that NMDS and PCA (both based on differing assumptions) don’t provide wildly different results.</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">471</span><span class="p">)</span><span class="w">
</span><span class="n">metal.mds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">metaMDS</span><span class="p">(</span><span class="n">metalCountData</span><span class="p">,</span><span class="w"> </span><span class="n">trace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> 
                     </span><span class="n">autotransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">noshare</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
                     </span><span class="n">wascores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">trymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Run 0 stress 0.1042079 
Run 1 stress 0.1041562 
... New best solution
... procrustes: rmse 0.008973122  max resid 0.04651044 
Run 2 stress 0.1037959 
... New best solution
... procrustes: rmse 0.06409011  max resid 0.3321104 
Run 3 stress 0.1052446 
Run 4 stress 0.1062545 
Run 5 stress 0.1062794 
Run 6 stress 0.1015691 
... New best solution
... procrustes: rmse 0.05271375  max resid 0.1365035 
Run 7 stress 0.1029558 
Run 8 stress 0.1061895 
Run 9 stress 0.1015154 
... New best solution
... procrustes: rmse 0.006515735  max resid 0.03648933 
Run 10 stress 0.1067396 
Run 11 stress 0.1015274 
... procrustes: rmse 0.001932787  max resid 0.006878349 
*** Solution reached
</code></pre>
</div>

<h3 id="multivariate-homogeneity-of-group-dispersions-for-nmds">Multivariate homogeneity of group dispersions for NMDS</h3>

<p>The same analysis as above but using Bray-Curtis distance. This is the default dissimilarity matrix used in the metaMDS function.</p>

<p>Need to do dispersion calculation on a distance matrix. Use bray distance</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">metal_tran_dis</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vegdist</span><span class="p">(</span><span class="n">metalCountData</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bray"</span><span class="p">)</span><span class="w">
</span><span class="n">disper</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">betadisper</span><span class="p">(</span><span class="n">metal_tran_dis</span><span class="p">,</span><span class="w"> </span><span class="n">genomeCategories</span><span class="o">$</span><span class="n">Taxa</span><span class="p">,</span><span class="w"> </span><span class="n">bias.adjust</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">disper</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>	Homogeneity of multivariate dispersions

Call: betadisper(d = metal_tran_dis, group = genomeCategories$Taxa,
bias.adjust = TRUE)

No. of Positive Eigenvalues: 26
No. of Negative Eigenvalues: 30

Average distance to median:
Roseobacter       SAR11 
     0.3628      0.3426 

Eigenvalues for PCoA axes:
 PCoA1  PCoA2  PCoA3  PCoA4  PCoA5  PCoA6  PCoA7  PCoA8 
7.4161 2.0080 1.4299 0.9981 0.8239 0.7594 0.6977 0.6206 
</code></pre>
</div>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">permutest</span><span class="p">(</span><span class="n">disper</span><span class="p">,</span><span class="w"> </span><span class="n">pairwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
          Df Sum Sq   Mean Sq      F N.Perm Pr(&gt;F)
Groups     1 0.0059 0.0058997 0.2734    999  0.611
Residuals 62 1.3378 0.0215781                     

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above diagonal)
            Roseobacter SAR11
Roseobacter             0.602
SAR11           0.60292      
</code></pre>
</div>

<p>So it looks like there is no significant difference in group dispersion between Roseobacter or SAR11 in the NMDS/Bray-Curtis case. Why is this result different than that for PCA which relies on a Euclidean dissimilarity structure? Let’s plot the NMDS plot to look closer…</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">metal.mds</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"p"</span><span class="p">)</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">metal.mds</span><span class="p">,</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sites"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Warning message:
In ordiplot(x, choices = choices, type = type, display = display, : Species scores not available
</code></pre>
</div>

<p><img src="/TM_roseo_sar/data_analysis/output_43_1.svg" alt="svg" /></p>

<p>In the NMDS ordination it looks like both AAA240-E13 and HIMB058 are big outliers. These genomes are not complete and/or amplified by MDA so they might not be refelecting a real trend here (potentially missing genes related to metal transport). Since NMDS is based on rank rather than absolute distances you lose information regarding the large differences in magnitude that you would expect with an analysis like PCA between SAR11 and Roseobacter. For example, instead of HTCC1002 being X arbitrary units away from Ruegeria TrichCH4B, HTCC1002 would be the “first, second, or third and so on” most distant object from CH4B. In that respect, in NMDS a lot of the biggest differences in magnitude between positioning in the ordination get compressed while smaller changes tend to be amplified.</p>

<p>Lets look at this again but omit AAA240-E13 and HIMB058 since they may be valid outliers.</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">471</span><span class="p">)</span><span class="w">
</span><span class="n">metalCountData.NOSAG</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">metalCountData</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">42</span><span class="p">,</span><span class="m">43</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">     </span><span class="c1">#remove AAA240-E13 and HIMB058
</span><span class="n">genomeCategories.NOSAG</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">genomeCategories</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">42</span><span class="p">,</span><span class="m">43</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="c1">#remove AAA240-E13 and HIMB058
</span><span class="n">genomeFeat.NOSAG</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">genomeFeat</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">42</span><span class="p">,</span><span class="m">43</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">             </span><span class="c1">#remove AAA240-E13 and HIMB058
</span></code></pre>
</div>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">metal.mds.NOSAG</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">metaMDS</span><span class="p">(</span><span class="n">metalCountData.NOSAG</span><span class="p">,</span><span class="w"> </span><span class="n">trace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
                           </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">autotransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
                           </span><span class="n">noshare</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">wascores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
                           </span><span class="n">trymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Run 0 stress 0.1191187 
Run 1 stress 0.1336855 
Run 2 stress 0.1191504 
... procrustes: rmse 0.003718555  max resid 0.01963279 
Run 3 stress 0.123536 
Run 4 stress 0.1191234 
... procrustes: rmse 0.003292331  max resid 0.01538293 
Run 5 stress 0.123536 
Run 6 stress 0.1226624 
Run 7 stress 0.1190997 
... New best solution
... procrustes: rmse 0.003516377  max resid 0.02218278 
Run 8 stress 0.1226623 
Run 9 stress 0.1226624 
Run 10 stress 0.1235359 
Run 11 stress 0.1235359 
Run 12 stress 0.123536 
Run 13 stress 0.1235359 
Run 14 stress 0.1235359 
Run 15 stress 0.1375248 
Run 16 stress 0.1191233 
... procrustes: rmse 0.005829302  max resid 0.03454454 
Run 17 stress 0.1339936 
Run 18 stress 0.1191471 
... procrustes: rmse 0.00501204  max resid 0.03359612 
Run 19 stress 0.1190998 
... procrustes: rmse 7.917323e-05  max resid 0.0003379384 
*** Solution reached
</code></pre>
</div>

<p>Now we’ll look again at the group dispersions. Need to do dispersion calculation on a distance matrix. Use bray distance</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">metal_tran_dis.NOSAG</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vegdist</span><span class="p">(</span><span class="n">metalCountData.NOSAG</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bray"</span><span class="p">)</span><span class="w">
</span><span class="n">disper.NOSAG</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">betadisper</span><span class="p">(</span><span class="n">metal_tran_dis.NOSAG</span><span class="p">,</span><span class="w"> </span><span class="n">genomeCategories.NOSAG</span><span class="o">$</span><span class="n">Taxa</span><span class="p">,</span><span class="w"> </span><span class="n">bias.adjust</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">disper.NOSAG</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>	Homogeneity of multivariate dispersions

Call: betadisper(d = metal_tran_dis.NOSAG, group =
genomeCategories.NOSAG$Taxa, bias.adjust = TRUE)

No. of Positive Eigenvalues: 25
No. of Negative Eigenvalues: 29

Average distance to median:
Roseobacter       SAR11 
     0.3628      0.2856 

Eigenvalues for PCoA axes:
 PCoA1  PCoA2  PCoA3  PCoA4  PCoA5  PCoA6  PCoA7  PCoA8 
7.4055 1.9920 1.1716 0.9338 0.7788 0.7025 0.6375 0.5098 
</code></pre>
</div>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">permutest</span><span class="p">(</span><span class="n">disper.NOSAG</span><span class="p">,</span><span class="w"> </span><span class="n">pairwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
          Df  Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)   
Groups     1 0.08071 0.080712 9.5915    999  0.005 **
Residuals 60 0.50490 0.008415                        
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above diagonal)
            Roseobacter SAR11
Roseobacter             0.002
SAR11         0.0029714      
</code></pre>
</div>

<p>Now these dispersion differences appear to be significant - albeit they are smaller in magnitude than what we saw for the euclidean distance in the PCA analysis. Still it is good to see the two methods generally agreeing, even though their underlying assumptions are quite different. Let’s now plot up the NMDS ordination missing the potentially incomplete genomes</p>

<p>Uses scores function to put site PC values into scrcs. Then associate a variable with them - in this case using the Lifestyle category. The result is a dataframe</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">scrs.mds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">scores</span><span class="p">(</span><span class="n">metal.mds.NOSAG</span><span class="p">,</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sites"</span><span class="p">))</span><span class="w">
</span><span class="n">scrs.mds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">scrs.mds</span><span class="p">,</span><span class="w"> </span><span class="n">lifestyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">genomeCategories.NOSAG</span><span class="o">$</span><span class="n">Lifestyle</span><span class="p">,</span><span class="w"> </span><span class="n">taxa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">genomeCategories.NOSAG</span><span class="o">$</span><span class="n">Taxa</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Fit factors and continuous variables to ordinations</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">152</span><span class="p">)</span><span class="w">
</span><span class="n">ef.mds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">envfit</span><span class="p">(</span><span class="n">metal.mds.NOSAG</span><span class="p">,</span><span class="w"> </span><span class="n">genomeFeat.NOSAG</span><span class="p">,</span><span class="w"> </span><span class="n">permu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">999</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Use the score function again to load direction of vectors. Vectors here are weighted by R<sup>2</sup> value</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">spp.scrs.mds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">scores</span><span class="p">(</span><span class="n">ef.mds</span><span class="p">,</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"vectors"</span><span class="p">))</span><span class="w">
</span><span class="n">spp.scrs.mds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">spp.scrs.mds</span><span class="p">,</span><span class="w"> </span><span class="n">Species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">spp.scrs.mds</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>make the ggplot object</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">scrs.mds</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NMDS1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NMDS2</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taxa</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifestyle</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">## need aspect ratio of 1!
</span><span class="w">  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spp.scrs.mds</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NMDS1</span><span class="p">,</span><span class="w"> 
                                    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NMDS2</span><span class="p">),</span><span class="w"> 
                                   </span><span class="n">arrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">)),</span><span class="w"> 
                                   </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spp.scrs.mds</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NMDS1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NMDS2</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/TM_roseo_sar/data_analysis/output_58_0.svg" alt="svg" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>It appears that PCA seems to be more sensitive to the “double zero problem” which is that ecological sites will tend to cluster based on species with many shared absences as opposed to those species with shared presences (paraphrased from Numerical Ecology by Legendre and Legendre). This is cited as a problem by Legendre and Legendre because traditional ecological studies treat double zeros aka shared absences of species as uninformative presumably due to the risk of false negatives. However, in our case zero values are true values. The absence of a gene in a set of genomes is actually informative in our case given that our risk for false negatives is effectively zero (albeit except for cases of the SAG and mda genomes). Therefore, we think that euclidean distance PCA best represents our data here. We do need to be careful about genome completeness, but at this stage in our exploratory analysis we think that it is unnecessary to omit AAA240-E13 and HIMB058 as they represent valuable phylogenetic diversity not encompassed by the other strains.</p>

  </article>
</div>

      </div>
    </div>
  </div>

  <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
        &copy;Copyright 
        	<script language="javascript" type="text/javascript">
			var today = new Date()
			var year = today.getFullYear()
			document.write(year)
			</script>
			 Shane L. Hogle</a> (<a href="https://twitter.com/slhogle">@slhogle</a>).
      </small>
    </div>
  </div>
</footer>



</body>
</html>
