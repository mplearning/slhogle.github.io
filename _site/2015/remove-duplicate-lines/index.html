<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Collecting top hits | Notes </title> <meta name="description" content=" Microbes + Biogeochemistry "> <meta name="keywords" content="Marine, microbial ecology, bacteria, biogeochemistry, ocean"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Shane Hogle"> <meta property="article:section" content="bioinformatics_notebook"> <meta property="article:tag" content=""> <meta property="article:published_time" content="2015-04-23 00:00:00 -0400"> <meta property="og:url" content="/2015/remove-duplicate-lines/"> <meta property="og:title" content=" Collecting top hits | Notes "> <meta property="og:image" content=""> <meta property="og:description" content=" Microbes + Biogeochemistry "> <meta property="og:site_name" content="Shane Hogle"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@slhogle"> <meta name="twitter:title" content=" Collecting top hits | Notes "> <meta name="twitter:description" content=" Microbes + Biogeochemistry "> <meta name="twitter:image:src" content=""> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Collecting top hits | Notes "> <meta itemprop="description" content=" Microbes + Biogeochemistry "> <meta itemprop="image" content=""> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="/assets/css/font-awesome.min.css"> <!-- Canonical link tag --> <link rel="canonical" href="/2015/remove-duplicate-lines/"> <link rel="alternate" type="application/rss+xml" title="Notes" href="/feed.xml"> <script type="text/javascript"> var disqus_shortname = 'slhogle-site'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-XXXXX-XX']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Notes<span></span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/research">research</a></li> <li><a href="/publications">publications</a></li> <li><a href="/contact">contact</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"><time datetime="2015-04-23T00:00:00-04:00" itemprop="datePublished">Apr 23, 2015</time></p> <h1 class="post-title" itemprop="name headline">Collecting top hits</h1> </header> <div class="post-content" itemprop="articleBody"> <p>Many times in bioinformatics you’ll have searched many sequences against a database (for example hmmscan versus pfamA). Say you are interested in only retaining the highest scoring PFAM hits for each of your query sequences. Depending on your cutoff score and the number of expected protein domains, each sequence may have gotten hits to multiple different PFAMs. For example, feoB transporters have GTPase-like binding domains, and it is easy to mis-annotate other sequences with GTPase domains as feoB proteins.</p> <p>To reduce a hmmscan output file to only the best scoring PFAMs you could use:</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">awk <span class="s1">'!x[$3]++'</span> MYOUTFILE.pfam  &gt; MYBESTHITS.pfam</code></pre></figure> <p>and you would get only the lines containing the PFAMs with highest full-sequence score.</p> <p>This code takes advantage of the fact that the output of hmmscan is already ordered with the highest scoring domain first for each sequence. In short, after it sees the first unique “query name” entry it removes all subsequent lines that have that “query name” entry then moves on to the next. If the sequences weren’t sorted with highest scoring PFAMs appearing first this wouldn’t give you the top hits - it would just de-duplicate your file. To make this work on other kinds of files you would need to sort them based on whatever value you are interested in.</p> <p>For example you could write:</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">sort -rnk3 FILE | awk <span class="s1">'!x[$2]++'</span> &gt; OUT</code></pre></figure> <p>This sorts FILE from highest to lowest (-r) based on column 3 (-k3) and orders it based on string numeric values (-n) then performs awk command on the output.</p> <p>I learned this little trick off stackoverflow and it is <a href="http://stackoverflow.com/questions/10842118/explain-this-duplicate-line-removing-order-retaining-one-line-awk-command">explained there</a> much betther than I can do, but I’ll take a crack at it anyways…</p> <p>Basically, what it is doing with our hmmscan output is:</p> <ul> <li>Read the current line as input</li> <li>Index array x with the entry in the “query name” field. If it doesnt already exist create it. Arrays in awk are associative so they are like dictionaries in python.</li> <li>Increment value of x[$3] but return the prior value, which will be zero if the “query name” entry has not been seen yet. This is called a postfix increment and is seen for example in C programming.</li> <li>Negate the resulting operator so its value is TRUE when x[$3] is zero causing awk to perform the default function which is print the line</li> <li>Actually increment so x[$3] is no longer zero. The next time the same entry in the “query name” field is seen, the value of x[$3] = 1.</li> <li>The operator is FALSE when x[$3] = 1, so awk does nothing. When a new value for $(3) is seen the process starts over.</li> </ul> <aside class="share"> <p>Share this post on <a href="http://twitter.com/share?text=Collecting top hits&amp;url=/2015/remove-duplicate-lines/&amp;via=slhogle" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter <i class="fa fa-twitter" aria-hidden="true" style="color:#00aced"></i></a> </p> </aside> </div> </article> <!-- // <aside id="comments" class="disqus"> <div class="container"> <h3><i class="icon icon-comments-o"></i> Comments</h3> <div id="disqus_thread"></div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */ var disqus_config = function () { this.page.url = "http://slhogle.github.io/"; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = '//slhogle-site.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </div> </aside> --> <footer class="site-footer"> <div class="container"> <div align="center"> <small class="block">&copy; 2016 Shane Hogle. All rights reserved.</small> </div> </div> </footer> </main> </body> </html>
