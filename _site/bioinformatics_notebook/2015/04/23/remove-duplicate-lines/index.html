<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Collecting top hits &#8211; Shane Hogle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="AWK one liner for removing duplicate entries in a delimited file">
    <meta name="author" content="Shane Hogle">
    <meta name="keywords" content="bioinformatics_notebook">
    <link rel="canonical" href="//bioinformatics_notebook/2015/04/23/remove-duplicate-lines/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Collecting top hits">
    <meta property="og:description" content="Microbes + Biogeochemistry">
    <meta property="og:url" content="//bioinformatics_notebook/2015/04/23/remove-duplicate-lines/">
    <meta property="og:site_name" content="Shane Hogle">
</head>

<body class="">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="/" class="site-title">Shane Hogle</a>
      <nav class="site-nav right">
        <a href="/about/">About</a>
<a href="/publications/">Publications</a>
<a href="/projects/">Projects</a>
<a href="/contact/">Contact</a>

      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>Collecting top hits</h1>
  <span class="post-meta">Apr 23, 2015</span><br>
  
  <span class="post-meta small">2 minute read</span>
</div>

<article class="post-content">
  <p>Many times in bioinformatics you&rsquo;ll have searched many sequences against a database (for example hmmscan versus pfamA). Say you are interested in only retaining the highest scoring PFAM hits for each of your query sequences. Depending on your cutoff score and the number of expected protein domains, each sequence may have gotten hits to multiple different PFAMs. For example, feoB transporters have GTPase-like binding domains, and it is easy to mis-annotate other sequences with GTPase domains as feoB proteins. </p>

<p>To reduce a hmmscan output file to only the best scoring PFAMs you could use:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">awk <span class="s1">&#39;!x[$3]++&#39;</span> MYOUTFILE.pfam  &gt; MYBESTHITS.pfam</code></pre></div>

<p>and you would get only the lines containing the PFAMs with highest full-sequence score.</p>

<p>This code takes advantage of the fact that the output of hmmscan is already ordered with the highest scoring domain first for each sequence. In short, after it sees the first unique &ldquo;query name&rdquo; entry it removes all subsequent lines that have that &ldquo;query name&rdquo; entry then moves on to the next. If the sequences weren&rsquo;t sorted with highest scoring PFAMs appearing first this wouldn&rsquo;t give you the top hits - it would just de-duplicate your file. To make this work on other kinds of files you would need to sort them based on whatever value you are interested in.</p>

<p>For example you could write:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sort -rnk3 FILE <span class="p">|</span> awk <span class="s1">&#39;!x[$2]++&#39;</span> &gt; OUT</code></pre></div>

<p>This sorts FILE from highest to lowest (-r) based on column 3 (-k3) and orders it based on string numeric values (-n) then performs awk command on the output.</p>

<p>I learned this little trick off stackoverflow and it is <a href="http://stackoverflow.com/questions/10842118/explain-this-duplicate-line-removing-order-retaining-one-line-awk-command">explained there</a> much betther than I can do, but I&rsquo;ll take a crack at it anyways&hellip;</p>

<p>Basically, what it is doing with our hmmscan output is:</p>

<ul>
<li>Read the current line as input</li>
<li>Index array x with the entry in the &ldquo;query name&rdquo; field. If it doesnt already exist create it. Arrays in awk are associative so they are like dictionaries in python.</li>
<li>Increment value of x[$3] but return the prior value, which will be zero if the &ldquo;query name&rdquo; entry has not been seen yet. This is called a postfix increment and is seen for example in C programming.</li>
<li>Negate the resulting operator so its value is TRUE when x[$3] is zero causing awk to perform the default function which is print the line</li>
<li>Actually increment so x[$3] is no longer zero. The next time the same entry in the &ldquo;query name&rdquo; field is seen, the value of x[$3] = 1.</li>
<li>The operator is FALSE when x[$3] = 1, so awk does nothing. When a new value for $(3) is seen the process starts over.</li>
</ul>

</article>







      </div>
    </div>
  </div>

  <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
        Â©Copyright 2014 Shane Hogle</a> (<a href="https://twitter.com/slhogle">@slhogle</a>).
      </small>
    </div>
  </div>
</footer>



</body>
</html>
